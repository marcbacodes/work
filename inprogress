function onOpen() {

    var ui = SpreadsheetApp.getUi();
    ui.createMenu("KPIs")
        .addItem("Generate KPIs", "generateKPIs")
        .addToUi();

};

function createNewTemplate() {

    var currentSheetTab = SpreadsheetApp.getActiveSpreadsheet().getSheets()[0];
    var sheetRange = currentSheetTab.getDataRange();
    var sheetValues = sheetRange.getValues();
    var month = new Date();
    var monthFormat = Utilities.formatDate(new Date(), "GMT", "MMMMMMMMM YYYY");
    var fileName = monthFormat + " " + "PRQA KPIs";
    var templateID = "1N8BSK_GkVyYD5FNctXR5vXVGcl6LkKc0mNPp5OcRWes";
    var folderID = "1CJVu3kQt3FHoBipL5N3_r3Efrh63bKy0";
    var KPIfolder = DriveApp.getFolderById(folderID);
    var newKPIfile = DriveApp.getFileById("1N8BSK_GkVyYD5FNctXR5vXVGcl6LkKc0mNPp5OcRWes").makeCopy(fileName, KPIfolder); // is there no better way than to use ID? i am not going to know what's the copy's ID for next month...

};

function copyPaste() {

    var currentSheetTab = SpreadsheetApp.getActiveSpreadsheet().getSheets()[0];
    var sheetRange = currentSheetTab.getDataRange();
    var sheetValues = sheetRange.getValues();
    var lastRow = sheetRange.getLastRow() - 1;
    var lastCol = sheetRange.getLastColumn();
    var A1Range = sheetRange.getA1Notation(); // getA1Notation is needed otherwise i get an error when replace A1Range with sheetRange in destinationSheet.getRange... // turns out i don't really need it

    var file, files = DriveApp.getFilesByName("October 2019 PRQA KPIs");
    //var file,files=DriveApp.getFilesByName("Latest Month KPIs"); // THIS NEEDS TO BE UPDATED NOW

    if (files.hasNext()) {
        file = files.next();
    } else {
        return "";
    };

    var destinationSS = SpreadsheetApp.openById(file.getId());
    var destinationSheet = destinationSS.getSheets()[1];
    var destinationRange = destinationSS.getDataRange();
    var destLastRow = sheetRange.getLastRow() - 1;
    //var newDestLastRow = destinationSheet.getDataRange().getValues().length;

    for (var x = 1; x <= lastRow; x++) {

        var row = sheetValues[x];
        var entityType = currentSheetTab.getRange(x + 1, 5).getValue();
        var currentMonth = currentSheetTab.getRange(x + 1, 1).getValue();
        var entityName = currentSheetTab.getRange(x + 1, 3).getValue();
        var profileUpdateDate = currentSheetTab.getRange(x + 1, 9).getValue();
        var inputsEdits = currentSheetTab.getRange(x + 1, 10).getValue();
        var noRounds = currentSheetTab.getRange(x + 1, 11).getValue();
        var noMgmt = currentSheetTab.getRange(x + 1, 12).getValue();
        var scoreCopy = currentSheetTab.getRange(x + 1, 20).getValue();
        var precision = currentSheetTab.getRange(x + 1, 22).getValue();
        var weightedPrecision = currentSheetTab.getRange(x + 1, 23).getValue();
        var recall = currentSheetTab.getRange(x + 1, 24).getValue();
        var weightedRecall = currentSheetTab.getRange(x + 1, 25).getValue();
        var unscoredErrors = currentSheetTab.getRange(x + 1, 26).getValue();
        var suggestions = currentSheetTab.getRange(x + 1, 27).getValue();
        var errorMap = currentSheetTab.getRange(x + 1, 28).getValue();
        var DNumber = currentSheetTab.getRange(x + 1, 34).getValue();


        var month = new Date(currentSheetTab.getRange(x + 1, 1).getValue()); // defines month as a date; var month=currentSheetTab.getRange(x+1,1).getValue() // doesn't work
        var formatMonth = month.getMonth() + 1;
        //var currentMonth=destinationSheet.getRange(2,2).getValue();
        //var newMonth=destinationSheet.getRange(x+2,1).getValue();
        //var newMonthFormat=newMonth.getMonth();
        //var formatMonth=Utilities.formatDate(new Date(month),"GMT","MM/YYYY");
        //var todayFormat=Utilities.formatDate(new Date(),"GMT","MM-YYYY");
        //var getMonth=newMonth.getMonth();
        //var formattedLastMonth=Utilities.formatDate(lastMonth,"GMT","MMM");
        var now = new Date();
        var nowMonth = now.getMonth() + 1;
        var formatNow = Utilities.formatDate(now, "GMT", "MM/YYYY");

        if (formatMonth == nowMonth && entityType == "EntCo") {

            destinationSheet.getRange(destLastRow + x, 1).setValue(currentMonth);
            destinationSheet.getRange(destLastRow + x, 2).setValue(entityName);
            destinationSheet.getRange(destLastRow + x, 4).setValue(entityType);
            destinationSheet.getRange(destLastRow + x, 5).setValue(profileUpdateDate);
            destinationSheet.getRange(destLastRow + x, 6).setValue(inputsEdits);
            destinationSheet.getRange(destLastRow + x, 7).setValue(noRounds);
            destinationSheet.getRange(destLastRow + x, 8).setValue(noMgmt);
            destinationSheet.getRange(destLastRow + x, 9).setValue(scoreCopy);
            destinationSheet.getRange(destLastRow + x, 10).setValue(precision);
            destinationSheet.getRange(destLastRow + x, 11).setValue(weightedPrecision);
            destinationSheet.getRange(destLastRow + x, 12).setValue(recall);
            destinationSheet.getRange(destLastRow + x, 13).setValue(weightedRecall);
            destinationSheet.getRange(destLastRow + x, 14).setValue(unscoredErrors);
            destinationSheet.getRange(destLastRow + x, 15).setValue(suggestions);
            destinationSheet.getRange(destLastRow + x, 16).setValue(errorMap);
            destinationSheet.getRange(destLastRow + x, 17).setValue(DNumber);

        }
    }
}
